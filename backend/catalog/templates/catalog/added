<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RedImports Mini App</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin-bottom: 40px; }
        .cards { display: flex; gap: 15px; flex-wrap: wrap; }
        .card { border: 1px solid #ccc; border-radius: 8px; padding: 10px; width: 150px; text-align: center; }
        .card img { width: 100%; height: 100px; object-fit: contain; margin-bottom: 5px; }
        h2 { margin-bottom: 15px; }
    </style>
</head>
<body>

<h1>RedImports Mini App</h1>

<div class="section" id="categories">
    <h2>Категории</h2>
    <div class="cards"></div>
</div>

<div class="section" id="brands">
    <h2>Бренды</h2>
    <div class="cards"></div>
</div>

<div class="section" id="products">
    <h2>Товары</h2>
    <div class="cards"></div>
</div>

<script>
const API_BASE = '/api/catalog/';

// --- Функция для рендеринга карточек ---
function renderCards(container, items, type) {
    container.innerHTML = '';
    items.forEach(item => {
        const card = document.createElement('div');
        card.className = 'card';

        let imgSrc = '';
        let name = '';

        switch(type) {
            case 'category':
                name = item.name;
                imgSrc = item.image ? item.image : '/static/default_category.png';
                break;

            case 'brand':
                name = item.name;
                imgSrc = item.logo_url || '/static/default_brand.png';
                break;

            case 'product':
                name = item.name;
                imgSrc = item.photos && item.photos.length > 0
                    ? item.photos[0]
                    : '/static/default_product.png';
                break;
        }

        card.innerHTML = `
            <img src="${imgSrc}" alt="${name}">
            <div>${name}</div>
        `;
        container.appendChild(card);
    });
}

// --- Загрузка категорий ---
fetch(API_BASE + 'categories/')
    .then(res => res.json())
    .then(data => {
        renderCards(document.querySelector('#categories .cards'), data, 'category');
    });

// --- Загрузка брендов ---
fetch(API_BASE + 'brands/')
    .then(res => res.json())
    .then(data => {
        renderCards(document.querySelector('#brands .cards'), data, 'brand');
    });

// --- Загрузка товаров ---
fetch(API_BASE + 'products/search/')
    .then(res => res.json())
    .then(data => {
        renderCards(document.querySelector('#products .cards'), data, 'product');
    });
</script>

</body>
</html>
